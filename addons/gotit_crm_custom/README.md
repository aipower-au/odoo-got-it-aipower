# GotIt CRM Custom Module

**Version:** 1.0.0
**Odoo Version:** 18.0
**Author:** GotIt Team
**Category:** Customer Relationship Management

## Overview

The `gotit_crm_custom` module extends Odoo 18 CRM functionality with GotIt-specific business requirements for Sprint 1. This module adds advanced customer/merchant/supplier management features including Vietnamese Tax ID (MST) integration, configurable salesperson assignment rules, enhanced duplicate detection, and REST API endpoints for external system integration.

## Features

### 1. Enhanced Customer/Partner Management

- **Tax ID (MST) Duplicate Checking**
  - SQL-level constraint preventing duplicate Tax IDs
  - Cross-field validation for phone/email + Tax ID combinations
  - Enforced salesperson consistency for duplicate contacts

- **Custom Fields**
  - `terms` - Payment terms specific to GotIt business
  - `purchase_revenue` - Customer revenue tracking
  - `sales_policy` - Policy level assignment
  - `contract_ids` - One2many relationship to contracts
  - `invoice_account_ids` - Multiple invoice accounts support

- **Status Automation**
  - Automatic status transition: "Potential" → "Client"
  - Triggered based on account creation completion
  - Configurable workflow rules

### 2. Configurable Salesperson Assignment

- **Assignment Rules Engine**
  - Rule-based assignment by:
    - Industry Group
    - Region
    - Customer Type
    - Order Value Range
  - Priority-based rule evaluation
  - Rule activation/deactivation
  - Assignment history tracking

- **Workflow Support**
  - No MST → Telesale
  - Telesale → Meeting/Verification
  - Verification → Conversion to Sale

### 3. Lead Management Enhancement

- **Lead Caretaker**
  - Pre-identification assignment tracking
  - Automatic return to correct salesperson when customer identified
  - Duplicate lead detection vs existing customers

### 4. Vietnamese Tax ID (MST) Integration

- **Mock MST Lookup Service**
  - Simulates third-party MST lookup API
  - Auto-fill company information from Tax ID
  - Extensible for real API integration
  - Button on partner form to trigger lookup

### 5. Bulk Operations

- **Bulk Salesperson Change Wizard**
  - For customers: Multi-select and reassign
  - For leads: Multi-select and reassign
  - Respects duplicate contact constraints
  - Success confirmation messaging

### 6. REST API Layer

- **External Integration Endpoints**
  - `POST /api/customer/create` - Create customer from Web/Hotline
  - `POST /api/lead/create` - Create lead from external sources
  - API key authentication
  - JSON request/response
  - Comprehensive error handling

## Installation

### Prerequisites

- Odoo 18.0 (Community or Enterprise)
- PostgreSQL 15+
- Python 3.11+
- Required Odoo modules: `base`, `contacts`, `crm`, `sale`, `mail`

### Installation Steps

1. **Copy module to addons directory:**
   ```bash
   cp -r gotit_crm_custom /path/to/odoo/addons/
   ```

2. **Update Odoo addons path** in `odoo.conf`:
   ```ini
   [options]
   addons_path = /mnt/extra-addons,/usr/lib/python3/dist-packages/odoo/addons
   ```

3. **Restart Odoo:**
   ```bash
   docker-compose restart odoo
   ```

4. **Activate Developer Mode** in Odoo:
   - Settings → Activate Developer Mode

5. **Update Apps List:**
   - Apps → Update Apps List

6. **Install the module:**
   - Apps → Search "GotIt CRM Custom" → Install

### Verify Installation

After installation, verify the following:

- [ ] New fields appear on Customer form (Settings → Contacts)
- [ ] Assignment Rules menu available (Sales → Configuration → Assignment Rules)
- [ ] Bulk Change Salesperson wizard accessible
- [ ] API endpoints respond (test with curl or Postman)

## Configuration

### 1. Configure Assignment Rules

**Navigate to:** Sales → Configuration → Assignment Rules

**Create a new rule:**

```
Name: North Region High-Value Customers
Priority: 10
Industry Group: Technology
Region: North Vietnam
Customer Type: Enterprise
Order Value Range: > 100,000,000 VND
Assigned Salesperson: John Doe
Active: ✓
```

**Rule Evaluation:**
- Rules are evaluated in priority order (lower number = higher priority)
- First matching rule assigns the salesperson
- If no rules match, assignment follows default logic

### 2. Configure API Access

**Navigate to:** Settings → Technical → API Keys

**Create API Key:**

```
Name: Web Integration
Key: <auto-generated>
Active: ✓
Allowed IPs: 192.168.1.0/24 (optional)
```

**Use the key in API requests:**

```bash
curl -X POST https://your-odoo.com/api/customer/create \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "ABC Company Ltd.",
    "vat": "0123456789",
    "phone": "+84912345678",
    "email": "contact@abc.com"
  }'
```

### 3. Import Existing Data

Update your import scripts to include new custom fields:

```bash
cd scripts/
python3 import_customers_enterprise.py
```

See `docs/IMPLEMENTATION.md` for detailed import script modifications.

## Usage

### Create Customer with Auto-Assignment

1. **Create new customer:**
   - Sales → Customers → Create

2. **Fill required fields:**
   - Company Name: "Tech Solutions Ltd."
   - Tax ID: "0123456789"
   - Industry: "Technology"
   - Region: "North"
   - Customer Type: "Enterprise"

3. **Save** - Salesperson auto-assigned based on matching rules

### Lookup Company by Tax ID

1. **Open customer form**
2. **Enter Tax ID** in the VAT field
3. **Click "Lookup by MST" button**
4. **Company details auto-fill** (mock data)

### Bulk Change Salesperson

1. **Navigate to:** Sales → Customers
2. **Select multiple customers** (checkbox)
3. **Action → Change Salesperson**
4. **Select new salesperson**
5. **Apply** - All selected customers reassigned

### Create Lead via API

**Request:**
```bash
curl -X POST https://your-odoo.com/api/lead/create \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Website Inquiry - ABC Corp",
    "contact_name": "Nguyen Van A",
    "email": "a.nguyen@abc.com",
    "phone": "+84987654321",
    "description": "Interested in enterprise package",
    "source": "website"
  }'
```

**Response:**
```json
{
  "success": true,
  "lead_id": 42,
  "lead_name": "Website Inquiry - ABC Corp",
  "assigned_to": "Tran Thi B (Telesale)",
  "message": "Lead created successfully"
}
```

## Module Structure

```
gotit_crm_custom/
├── __init__.py                 # Module initialization
├── __manifest__.py             # Module metadata
├── README.md                   # This file
├── docs/
│   └── IMPLEMENTATION.md       # Technical implementation guide
├── models/
│   ├── __init__.py
│   ├── res_partner.py          # Customer/partner extensions
│   ├── crm_lead.py             # Lead extensions
│   ├── assignment_rule.py      # Assignment rules engine
│   ├── tax_id_service.py       # MST lookup service
│   └── api_key.py              # API authentication
├── views/
│   ├── res_partner_views.xml   # Customer form/tree views
│   ├── crm_lead_views.xml      # Lead form/tree views
│   ├── assignment_rule_views.xml
│   └── menu_items.xml          # Menu structure
├── wizards/
│   ├── __init__.py
│   ├── bulk_change_salesperson.py
│   └── bulk_change_salesperson_views.xml
├── controllers/
│   ├── __init__.py
│   └── api.py                  # REST API endpoints
├── security/
│   ├── ir.model.access.csv     # Access rights
│   └── security.xml            # Record rules
└── data/
    └── assignment_rules_demo.xml  # Demo data
```

## API Documentation

### Authentication

All API endpoints require API key authentication:

```
Authorization: Bearer YOUR_API_KEY
```

### Endpoints

#### POST /api/customer/create

Create a new customer/partner.

**Request Body:**
```json
{
  "name": "Company Name",
  "vat": "0123456789",
  "phone": "+84912345678",
  "email": "contact@company.com",
  "street": "123 Main St",
  "city": "Hanoi",
  "country_id": 241,
  "terms": "net30",
  "entity_type": "company",
  "customer_type": "enterprise"
}
```

**Response:**
```json
{
  "success": true,
  "partner_id": 123,
  "name": "Company Name",
  "assigned_salesperson": "John Doe",
  "message": "Customer created successfully"
}
```

#### POST /api/lead/create

Create a new lead.

**Request Body:**
```json
{
  "name": "Lead Name",
  "contact_name": "Contact Person",
  "email": "contact@example.com",
  "phone": "+84987654321",
  "description": "Lead description",
  "source": "website"
}
```

**Response:**
```json
{
  "success": true,
  "lead_id": 456,
  "lead_name": "Lead Name",
  "assigned_to": "Jane Smith",
  "message": "Lead created successfully"
}
```

### Error Responses

**400 Bad Request:**
```json
{
  "error": "Validation Error",
  "message": "Tax ID already exists",
  "field": "vat"
}
```

**401 Unauthorized:**
```json
{
  "error": "Authentication Failed",
  "message": "Invalid or missing API key"
}
```

**500 Internal Server Error:**
```json
{
  "error": "Server Error",
  "message": "An unexpected error occurred"
}
```

## Compatibility

- **Odoo Version:** 18.0 (Community & Enterprise)
- **Python:** 3.11+
- **PostgreSQL:** 15+
- **Browser Support:** Chrome, Firefox, Safari, Edge (latest versions)

## Dependencies

**Required Odoo Modules:**
- `base` - Base Odoo functionality
- `contacts` - Contact/Partner management
- `crm` - CRM functionality
- `sale` - Sales management
- `mail` - Messaging and activity tracking

**Python Libraries:**
- Standard library only (no external dependencies)

## Support & Documentation

- **Technical Documentation:** See `docs/IMPLEMENTATION.md`
- **Sprint 1 Requirements:** See `docs/SPRINT_1_REQUIREMENTS_EN.md`
- **Import Scripts:** See `scripts/` directory
- **Issues:** Contact GotIt development team

## License

Proprietary - GotIt Internal Use Only

## Changelog

### Version 1.0.0 (Sprint 1)

**Added:**
- Custom fields for customer management
- Tax ID duplicate checking
- Configurable assignment rules engine
- Mock MST lookup service
- Status automation
- Bulk salesperson change wizards
- REST API for customer/lead creation
- Lead caretaker functionality
- Enhanced security and access controls

## Contributing

For internal development team only. Follow Odoo 18 development guidelines and GotIt coding standards.

## Credits

**Development Team:**
- GotIt Development Team
- Based on Odoo 18.0 CRM module

---

**Last Updated:** 2025-11-02
